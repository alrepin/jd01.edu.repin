## Курсовая работа 6 курса: “Бот в Telegram”

***
В курсовой работе к шестому курсу вам необходимо разработать бота для Telegram, который умел бы принимать от
пользователя сообщения в формате 01.01.2022 20:00 Сделать домашнюю работу и присылать пользователю сообщение в 20:00 1
января 2022 года с текстом “Сделать домашнюю работу”.

### Реализация приложения

#### Рекомендации по организации проекта.

##### 1. Добавить телеграм бота в https://t.me/BotFather.

Активировать его командой /start и следовать инструкциями. Главная цель этой задачи — получить токен, который будет
использоваться при разработке SpringBoot - приложения с доступом к Bot API Telegram.

##### 2. Клонировать репозиторий с проектом - заготовкой.

Цель задачи — получить у себя на компьютере шаблон приложения с настроенным для работы Spring Boot’ом.
Здесь вам необходимо форкнуть репозиторий и клонировать его к себе в директорию с Java проектами. Взять репозиторий
можно и из архива, представленного ниже.
https://s3-us-west-2.amazonaws.com/secure.notion-static.com/a66d2a91-e4bf-4c9f-9ca4-f3668766a2ab/telegram-bot.zip

##### 3. Сконфигурировать склонированное приложение.

Цель задачи — получить работающий проект на вашем компьютере, который можно запустить в IDEA.
Необходимо создать базу данных и пользователя, которая будет использоваться вашим приложением. Используя
application.properties настроить подключение к базе данных и передать токен, полученный в 1ой задаче.

##### 4. Научиться реагировать на команду /start и выводить приветственное сообщение.

Теперь, когда у вас есть запускающийся проект, самое время в классе TelegramBotUpdatesListener в методе public int
process(List<Update> updates) научиться обрабатывать команду /start, отправляемую пользователем нашему боту в Telegram.
Для этого необходимо проитерироваться по всем апдейтам, которые наш метод принимает в качестве аргумента и, в случае,
если мы получили сообщение /start — вывести приветственное сообщение. Текст сообщения — на ваш вкус.

_Подсказка
Текст сообщения можно найти в update.message().text()_

_Подсказка
Для получения идентификатора чата, в который нужно отправить сообщение, нужно вызвать update.message().chat().id()_

##### 5. Создать использую liquibase таблицу notification_task

Цель задачи — получить после старта приложения таблицу нужной нам структуры в БД.
Теперь настало самое время понять, как мы будем хранить наши таски в базе данных и спроектировать для этого схему базы
данных. Предположу, что нам потребуется иметь первичный ключ в таблице, идентификатор чата, в который нужно отправить
уведомление, текст уведомления и дату+время, когда требуется отправить уведомление. Возможно, вы захотите хранить
какие-то дополнительные данные. Примерно такой структуры нужно создать таблицу используя liquibase.

##### 6. Создать сущность notification task

Цель задачи — получить класс с аннотацией @Entity, который будет повторять структуру нашей таблицы в БД и будет пригоден
для использования в коде нашего приложения.
После того как мы создали таблицу, необходимо создать сущность, с которой мы будем работать в коде нашего приложения.

_Подсказка
Для представления даты и времени удобно использовать класс LocalDateTime_

##### 7. Создать репозиторий для сущности notification task

Цель задачи — получить интерфейс, с помощью которого можно сохранять и доставать из БД наши сущности.
Следующий шаг — создать расширение JpaRepository<T, ID>, который был бы пригоден для работы с сущностью, созданной в предыдущем шаге.

##### 8. Научиться парсить сообщения с создаваемым напоминанием и сохранять их в БД

Цель задачи — получить записи в базе данных, соответствующие отправленным сообщениям.
Наконец-то мы добрались до самого важного задания — мы должны научиться обрабатывать получаемые от пользователя сообщения вида "01.01.2022 20:00 Сделать домашнюю работу", вычленять из них дату+время `01.01.2022 20:00` и текст напоминания `Сделать домашнюю работу`, создавать на основе этих данных сущности и сохранять их в БД.

_Подсказка
Для распознавания в строке подстроки с датой и подстроки с сообщением нам потребуются регулярные выражения._

После того как мы отделили дату и текст напоминания во входящем сообщении, нам необходимо сконструировать сущность.

_Подсказка
Для того, чтобы из строки вида 01.01.2022 20:00 сконструировать объект класса LocalDateTime необходимо использовать кастомный паттерн и вызывать метод вида `LocalDateTime.parse("01.01.2022 20:00", DateTimeFormatter.ofPattern("dd.MM.yyyy HH:mm"))`_

Имея сконструированную сущность необходимо сохранить её используя методы репозитория.

##### 9. Научиться по шедулеру раз в минуту выбирать записи из БД, для которых должны быть отправлены нотификации.

Цель задачи — иметь коллекцию записей из БД у которых дата и время отправки нотификации сейчас.

Необходимо выполнять раз в минуту метод, который ищет записи в БД с датой выполнения — текущая минута.

_Подсказка
cron expression для запуска метода каждую секунду — 0 0/1 * * * *_

_Подсказка
Так как шедулер может запускаться с лагом в несколько миллисекунд, то для поиска лучше не просто брать текущее время методом `LocalDateTime.now()`, а “обрезать” его до минут, чтобы получилось время с 00 секунд. Это делается методом **truncatedTo** так `LocalDateTime.now().truncatedTo(ChronoUnit.MINUTES)`._

Помимо этого, нужно написать в репозитории метод поиска записей, у которых время совпадает с текущим.

##### 10. Научиться для выбранных записей рассылать уведомления.
Для полученной коллекции записей из прошлой задачи необходимо рассылать уведомления в нужные чаты.
***